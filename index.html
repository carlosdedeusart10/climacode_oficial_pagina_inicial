<!DOCTYPE html>
<html lang="pt-BR">
<head>
  <meta charset="UTF-8" />
  <meta name="viewport" content="width=device-width, initial-scale=1.0" />
  <title>CLIMACODE_OFICIAL | Login</title>
  <style>
    body {
      font-family: "Segoe UI", sans-serif;
      background: radial-gradient(circle at top, #0f172a, #020617);
      color: #e2e8f0;
      min-height: 100vh;
      display: flex;
      align-items: center;
      justify-content: center;
      transition: 0.3s;
    }
    .hidden { display: none; }
    .container {
      width: 90%; max-width: 400px;
      background: rgba(15,23,42,0.85);
      border-radius: 12px;
      padding: 25px;
      text-align: center;
      box-shadow: 0 0 20px rgba(0,0,0,0.4);
    }
    input {
      width: 100%; padding: 10px; margin: 8px 0;
      border-radius: 8px; border: none; outline: none;
      background: #1e293b; color: white;
    }
    button {
      width: 100%; padding: 10px;
      background-color: #3b82f6; border: none;
      border-radius: 8px; color: white; font-size: 1rem;
      cursor: pointer; margin-top: 10px;
    }
    button:hover { background-color: #2563eb; }
    .toggle { margin-top: 10px; cursor: pointer; color: #93c5fd; }
    #logoutBtn {
      background: #ef4444; padding: 10px 24px;
      border-radius: 999px; border: none; color: white;
      cursor: pointer; font-weight: 700;
      margin: 30px auto 0 auto;
      display: block;
    }
    #logoutBtn:hover { background: #dc2626; transform: scale(1.05); }
  </style>

  <!-- ======== Adições: Tema Automático + Centralização ======== -->
  <style>
    /* Centralização melhorada */
    #app {
      display: flex;
      flex-direction: column;
      align-items: center;
      justify-content: center;
      text-align: center;
    }

    #app img {
      margin-top: 20px;
      width: 200px;
      border-radius: 12px;
    }

    #app h1 {
      font-size: 2rem;
      color: var(--text-primary);
      margin-bottom: 8px;
    }

    #app h2 {
      font-size: 1rem;
      color: var(--text-secondary);
      margin-bottom: 16px;
    }

    /* Botões e layout central */
    #app button {
      width: 80%;
      max-width: 300px;
      margin: 10px 0;
      border-radius: 999px;
      font-weight: bold;
    }

    /* Tema automático */
    :root {
      --bg: #f9fafb;
      --text-primary: #1e3a8a;
      --text-secondary: #334155;
      --card-bg: #ffffff;
    }

    @media (prefers-color-scheme: dark) {
      :root {
        --bg: radial-gradient(circle at top, #0f172a, #020617);
        --text-primary: #60a5fa;
        --text-secondary: #93c5fd;
        --card-bg: rgba(15, 23, 42, 0.8);
      }
    }

    body {
      background: var(--bg);
      color: var(--text-primary);
      transition: background 0.4s, color 0.4s;
    }

    .container {
      background: var(--card-bg);
      transition: background 0.4s;
    }
  </style>

  <script>
    // Detecta mudança no tema do sistema em tempo real
    window.matchMedia('(prefers-color-scheme: dark)').addEventListener('change', e => {
      document.body.style.background = e.matches
        ? 'radial-gradient(circle at top, #0f172a, #020617)'
        : '#f9fafb';
    });
  </script>
  <!-- ======== Fim das adições ======== -->

</head>
<body>

  <!-- LOGIN -->
  <div id="loginPage" class="container">
    <h2 style="color:#60a5fa;">Login</h2>
    <input type="email" id="loginEmail" placeholder="E-mail" />
    <input type="password" id="loginPass" placeholder="Senha" />
    <button id="loginBtn">Entrar</button>
    <p class="toggle" onclick="showRegister()">Criar conta</p>
  </div>

  <!-- REGISTRO -->
  <div id="registerPage" class="container hidden">
    <h2 style="color:#60a5fa;">Criar conta</h2>
    <input type="text" id="regUser" placeholder="Nome de usuário" />
    <input type="email" id="regEmail" placeholder="E-mail" />
    <input type="password" id="regPass" placeholder="Senha" />
    <button id="registerBtn">Registrar</button>
    <p class="toggle" onclick="showLogin()">Já tenho conta</p>
  </div>

  <!-- CONTEÚDO PRINCIPAL -->
  <div id="mainContent" class="hidden">
    <div id="app"></div>
    <button id="logoutBtn">Sair</button>
  </div>

  <script type="module">
    import { initializeApp } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-app.js";
    import { 
      getAuth, createUserWithEmailAndPassword, 
      signInWithEmailAndPassword, signOut, onAuthStateChanged 
    } from "https://www.gstatic.com/firebasejs/11.0.1/firebase-auth.js";
    import { getFirestore, setDoc, doc, getDoc } 
      from "https://www.gstatic.com/firebasejs/11.0.1/firebase-firestore.js";

    // === CONFIG DO FIREBASE ===
    const firebaseConfig = {
      apiKey: "AIzaSyDUUbwQj2E9ugrIPrp88yiBC-h76nk2_8c",
      authDomain: "clima-743d0.firebaseapp.com",
      projectId: "clima-743d0",
      storageBucket: "clima-743d0.firebasestorage.app",
      messagingSenderId: "700610995947",
      appId: "1:700610995947:web:b644ddaacde92e40ce80ae",
      measurementId: "G-J56Y32XTCD"
    };

    const app = initializeApp(firebaseConfig);
    const auth = getAuth(app);
    const db = getFirestore(app);

    // ELEMENTOS
    const loginPage = document.getElementById("loginPage");
    const registerPage = document.getElementById("registerPage");
    const mainContent = document.getElementById("mainContent");
    const logoutBtn = document.getElementById("logoutBtn");

    // === TROCAR ENTRE TELAS ===
    window.showLogin = function() {
      loginPage.classList.remove("hidden");
      registerPage.classList.add("hidden");
      mainContent.classList.add("hidden");
    };

    window.showRegister = function() {
      loginPage.classList.add("hidden");
      registerPage.classList.remove("hidden");
    };

    // === CADASTRO ===
    document.getElementById("registerBtn").addEventListener("click", async () => {
      const user = document.getElementById("regUser").value.trim();
      const email = document.getElementById("regEmail").value.trim();
      const pass = document.getElementById("regPass").value;

      if (!user || !email || !pass) return alert("Preencha todos os campos!");

      try {
        const cred = await createUserWithEmailAndPassword(auth, email, pass);
        await setDoc(doc(db, "users", cred.user.uid), {
          username: user,
          email: email,
          createdAt: new Date().toISOString()
        });
        alert("Conta criada com sucesso!");
        showLogin();
      } catch (e) {
        alert("Erro ao registrar: " + e.message);
      }
    });

    // === LOGIN (corrigido) ===
    document.getElementById("loginBtn").addEventListener("click", async () => {
      const email = document.getElementById("loginEmail").value.trim();
      const pass = document.getElementById("loginPass").value;

      if (!email || !pass) return alert("Preencha e-mail e senha!");

      try {
        const cred = await signInWithEmailAndPassword(auth, email, pass);
        console.log("Usuário logado:", cred.user.email);
      } catch (e) {
        alert("Erro ao entrar: " + e.message);
      }
    });

    // === LOGOUT ===
    logoutBtn.addEventListener("click", async () => {
      await signOut(auth);
    });

    // === MONITOR DE AUTENTICAÇÃO ===
    onAuthStateChanged(auth, async (user) => {
      if (user) {
        const snap = await getDoc(doc(db, "users", user.uid));
        const data = snap.exists() ? snap.data() : {};
        showMain(user, data);
      } else {
        showLogin();
      }
    });

    // === MOSTRAR CONTEÚDO ===
    function showMain(user, data) {
      loginPage.classList.add("hidden");
      registerPage.classList.add("hidden");
      mainContent.classList.remove("hidden");

      const appDiv = document.getElementById("app");
      appDiv.innerHTML = `
        <h1>CLIMACODE_OFICIAL</h1>
        <h2>Bem-vindo, ${data.username || user.email}</h2>
        <img src="https://i.postimg.cc/Jhj3w0GD/Sem-titulo.jpg" />
        <button onclick="window.open('https://climacodeoficial10.github.io/Climacode_oficial_seu-clima/', '_blank')">
          Ver Clima em Tempo Real
        </button>
      <h4> SOBRE O PROJETO:Diante da intensificação das temperaturas e da irregularidade pluviométrica na Região Metropolitana de Salvador, e considerando que as estações oficiais não registram as variações microclimáticas influenciadas por fatores locais (vegetação, relevo, corpos d'água e urbanização) em Simões Filho, este projeto visa suprir a lacuna de dados. Está em desenvolvimento e implementaçao uma miniestação meteorológica automatizada baseada em Arduino/ESP32 para monitorar em tempo real as variáveis ambientais no IFBA Campus Simões Filho e na APA Joanes Ipitanga. O objetivo central é compreender e monitorar as variações climáticas locais, fortalecendo a educação ambiental e o monitoramento dos impactos das mudanças climáticas regionais.</h3>
       <br>
  
  <section>
          <p>&copy; 2025 Projeto CLIMACODE | Instituto Federal da Bahia</p>
          <p>Desenvolvido por 
            <a href="https://www.instagram.com/carlosdedeus_art_1.0" target="_blank">
              @carlosdedeus_art_1.0
            </a>
          </p>
 
  </section>
      `;
    }
  
  </script>
  
</body>
</html>